{% extends "base.html" %}
{% block content %}
<div class="container">
    <div class="nav">
  <a href="/">홈</a>
  <a href="/upload">파일 업로드</a>
  <a href="/jobs">작업 목록</a>
    </div>
    <h2>작업 결과</h2>
    {% if job %}
  <div class="info">파일명: {{ job.get('file_name','-') }}</div>
      <div class="info">상태: {{ job['status'] }}</div>
      <div class="info">업로드: {{ job.get('created_at','-') }}</div>
      <div class="info">완료: {{ job.get('completed_at','-') }}</div>
      <div class="info">배치: {{ job.get('batches_done',0) }} / {{ job.get('batches_total','-') }}</div>
      {% if job['status'] == '완료' %}
        <div style="margin:16px 0; display:flex; gap:12px; flex-wrap:wrap;">
            <a class="download-btn" href="/download/{{ job['job_id'] }}">Markdown 다운로드</a>
            <button type="button" class="download-btn" style="background:#6366f1;" onclick="toggleRaw()">원문 토글</button>
        </div>
        {% if markdown_html %}
          <div class="md-preview" id="md-preview">{{ markdown_html | safe }}</div>
        {% endif %}
        <div class="result-text" id="raw-md" style="display:none;">{{ markdown_text | safe }}</div>
      {% elif job['status'] == '실패' %}
        <div style="margin-top:16px;color:#dc2626;font-weight:bold;">실패: {{ job.get('error','원인 미상') }}</div>
      {% else %}
        <div style="margin-top:16px;color:#666;">아직 처리 중입니다. 잠시 후 새로고침하세요.</div>
      {% endif %}
    {% else %}
      <div style="color:#dc2626;font-weight:bold;">작업 정보를 찾을 수 없습니다.</div>
    {% endif %}
</div>
<script>
function toggleRaw() {
  const raw = document.getElementById('raw-md');
  const preview = document.getElementById('md-preview');
  if (!raw) return;
  const showing = raw.style.display === 'block';
  raw.style.display = showing ? 'none' : 'block';
  if (preview) preview.style.display = showing ? 'block' : 'none';
}
</script>
{% endblock %}
